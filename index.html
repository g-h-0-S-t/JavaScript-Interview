<!-- {% raw %} -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Interview Guide</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Highlight.js base -->
    <link 
        id="hljs-theme"
        rel="stylesheet" 
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />

    <!-- GitHub Markdown CSS -->
    <link 
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.4.0/github-markdown.min.css"
    />

    <link rel="stylesheet" href="styles.css">

    <!-- Mermaid -->
    <script type="module">
        import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
        window.mermaid = mermaid;
        mermaid.initialize({
            startOnLoad: false,
            theme: "neutral",
            securityLevel: "loose"
        });
    </script>

    <!-- Marked -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">JS Interview Guide</h1>
            <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
                <svg class="sun-icon" width="24" height="24" stroke-width="2">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                </svg>
                <svg class="moon-icon" width="24" height="24" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3"></path>
                </svg>
            </button>
        </div>
    </nav>

    <main class="container">
        <div id="content" class="markdown-body"></div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 JavaScript Interview Guide | MIT License</p>
            <p>Created by <a href="https://github.com/g-h-0-S-t" target="_blank">g-h-0-S-t</a></p>
        </div>
    </footer>

<script>
/* --------------------------- THEME TOGGLE --------------------------- */
const themeToggle = document.getElementById("themeToggle");
const html = document.documentElement;

const savedTheme = localStorage.getItem("theme") || "dark";
html.setAttribute("data-theme", savedTheme);

/* Update hljs theme instantly */
document.getElementById("hljs-theme").href =
    savedTheme === "dark"
        ? "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
        : "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css";

themeToggle.addEventListener("click", () => {
    const current = html.getAttribute("data-theme");
    const next = current === "dark" ? "light" : "dark";
    html.setAttribute("data-theme", next);
    localStorage.setItem("theme", next);

    document.getElementById("hljs-theme").href =
        next === "dark"
            ? "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
            : "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css";
});

/* --------------------------- MARKED CONFIG --------------------------- */
marked.setOptions({
    gfm: true,
    breaks: true,
    headerIds: true,
    mangle: false,
});

/* Custom renderer to avoid [object Object] */
const renderer = new marked.Renderer();

renderer.code = function (code, lang) {
    const language = (lang || "").trim().toLowerCase();

    if (language === "mermaid") {
        return `<pre class="mermaid">${code}</pre>`;
    }

    return `<pre><code class="language-${language}">${code.replace(/</g, "&lt;")}</code></pre>`;
};

marked.use({ renderer });

/* --------------------------- LOAD README --------------------------- */
async function loadReadme() {
    const url = "https://raw.githubusercontent.com/g-h-0-S-t/JavaScript-Interview/main/README.md";

    const res = await fetch(url);
    const text = await res.text();

    const html = marked.parse(text);
    document.getElementById("content").innerHTML = html;

    /*  Highlight Blocks (skip mermaid)  */
    document.querySelectorAll("pre code").forEach(block => {
        if (block.parentElement.classList.contains("mermaid")) return;
        hljs.highlightElement(block);
    });

    /* Mermaid fix: run AFTER markdown injected */
    setTimeout(() => {
        if (window.mermaid) {
            mermaid.run({ querySelector: ".mermaid" });
        }
    }, 300);
}

loadReadme();

/* --------------------------- SMOOTH ANCHORS --------------------------- */
document.addEventListener("click", (e) => {
    if (e.target.matches('a[href^="#"]')) {
        e.preventDefault();
        const id = e.target.getAttribute("href");
        const el = document.querySelector(id);
        if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    }
});
</script>

</body>
</html>
<!-- {% endraw %} -->
